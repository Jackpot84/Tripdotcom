<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="User">
	<insert id="join" parameterType="com.koreait.user.dto.UserBean" >
		INSERT INTO TRIP_USER (USER_ID ,USER_EMAIL,USER_PW,USER_JOINDATE) VALUES (TRIP_USER_seq.nextval,#{user_email},#{user_pw},sysdate)
	</insert>
	
	<select id="login" parameterType="com.koreait.user.dto.UserBean" resultType="com.koreait.user.dto.UserBean">
		SELECT * FROM TRIP_USER tu WHERE USER_EMAIL = #{user_email} AND USER_PW = #{user_pw}
	</select>
	
	<select id="getReservation" parameterType="_int" resultType="com.koreait.user.dto.ReservationPaymentsBean">
		SELECT * FROM RESERVATION_PAYMENTS WHERE USER_ID = #{user_id}
	</select>
	
	
	<select id="getResList" resultType="com.koreait.user.dto.ReservationPaymentsBean" parameterType="hashmap">
	 SELECT * FROM 
		(SELECT rownum R, d.*
			FROM (SELECT * FROM RESERVATION_PAYMENTS WHERE user_id = #{user_id} ORDER BY RESERVATION_ID DESC) D ) B
	 WHERE B.R BETWEEN #{startRow} AND #{endRow}
	</select>
	
	<select id="getYetPaidList" resultType="com.koreait.user.dto.ReservationPaymentsBean" parameterType="hashmap">
	 SELECT * FROM 
		(SELECT rownum R, d.*
			FROM (SELECT * FROM RESERVATION_PAYMENTS WHERE user_id = #{user_id} AND RESERVATION_STATE ='결제대기' ORDER BY RESERVATION_ID DESC) D ) B
	 WHERE B.R BETWEEN #{startRow} AND #{endRow}
	</select>
	
	<select id="getPaidList" resultType="com.koreait.user.dto.ReservationPaymentsBean" parameterType="hashmap">
	 SELECT * FROM 
		(SELECT rownum R, d.*
			FROM (SELECT * FROM RESERVATION_PAYMENTS WHERE user_id = #{user_id} AND RESERVATION_STATE ='결제완료' ORDER BY RESERVATION_ID DESC) D ) B
	 WHERE B.R BETWEEN #{startRow} AND #{endRow}
	</select>
	
	<select id="resAllCount" parameterType="_int" resultType="_int">
	SELECT COUNT(*) FROM RESERVATION_PAYMENTS rp WHERE USER_ID =#{user_id}
	</select>
	
	<select id="yetPaidCount" parameterType="_int" resultType="_int">
	SELECT COUNT(*) FROM RESERVATION_PAYMENTS rp WHERE USER_ID =#{user_id} AND RESERVATION_STATE ='결제대기'
	</select>

	<select id="PaidCount" parameterType="_int" resultType="_int">
	SELECT COUNT(*) FROM RESERVATION_PAYMENTS rp WHERE USER_ID =#{user_id} AND RESERVATION_STATE ='결제완료'
	</select>

	<select id="bookmarkCount" parameterType="_int" resultType="_int">
	SELECT COUNT(*) FROM BOOKMARK rp WHERE USER_ID =#{user_id}
	</select>
	
	<select id="getBookmarkList" resultType="com.koreait.user.dto.BookmarkBean" parameterType="hashmap">
	 SELECT * FROM 
	(SELECT rownum R, d.*
		FROM (SELECT * FROM BOOKMARK WHERE user_id = #{user_id}) D ) B
	 WHERE B.R BETWEEN #{startRow} AND #{endRow}
	</select>
	
	<delete id="bookmarkDelete" parameterType="_int">
		DELETE FROM BOOKMARK b WHERE BOOKMARK_ID = #{bookmarkId}
	</delete>
	
	<update id="userInfoUpdate" parameterType="com.koreait.user.dto.UserBean">
		UPDATE TRIP_USER SET USER_LASTNAME =#{user_lastname},USER_FIRSTNAME =#{user_firstname} ,USER_EMAIL =#{user_email},USER_GENDER =#{user_gender} WHERE USER_ID =#{user_id}
	</update>
	<update id="userAccountUpdate" parameterType="com.koreait.user.dto.UserBean">
		UPDATE TRIP_USER SET USER_EMAIL =#{user_email},USER_PW =#{user_pw} WHERE USER_ID =#{user_id}
	</update>
	
	<select id="getUseCoinList" parameterType="_int" resultType="com.koreait.user.dto.TripCoinBean">
		SELECT * FROM TRIP_COIN tc WHERE USER_ID =#{user_id} AND COIN_USE_MONEY IS NOT null
	</select>

	<select id="getChargeCoinList" parameterType="_int" resultType="com.koreait.user.dto.TripCoinBean">
		SELECT * FROM TRIP_COIN tc WHERE USER_ID =#{user_id} AND COIN_CHARGE_MONEY IS NOT null
	</select>
</mapper>





